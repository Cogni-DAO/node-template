{
  log {
    level INFO
    format json
    output file /data/logs/caddy/caddy.log
  }
}

# Redirect www to non-www (canonical domain)
www.{$DOMAIN} {
  redir https://{$DOMAIN}{uri} permanent
}

# Canonical domain
{$DOMAIN} {
  encode zstd gzip
  reverse_proxy app:3000
  redir /sourcecred /sourcecred/
  handle_path /sourcecred/* {
    reverse_proxy sourcecred:6006
  }
  log {
    format json
    output file /data/logs/caddy/access.log
  }
}
