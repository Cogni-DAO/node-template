# Test Environment Overrides
# Copy this to .env.test (never commit .env.test)
# Creates a test environmnent for our test:stack tests
# Most important differences: APP_ENV=test, POSTGRES_DB=unique_test_name

# Switch to test mode (enables fake adapters)
APP_ENV=test

DOMAIN=localhost

# Database connections — both required, distinct users for RLS enforcement.
# Per DATABASE_RLS_SPEC.md design decision 7: explicit DSNs only.
# app_user role (RLS enforced) — used by Next.js request paths
DATABASE_URL="postgresql://app_user:password@localhost:55432/cogni_template_stack_test"
# app_service role (BYPASSRLS) — used by auth, workers, bootstrap
DATABASE_SERVICE_URL="postgresql://app_service:service_password@localhost:55432/cogni_template_stack_test"
# ⚠️  FRAGILE: If you change app_service credentials or DB name above, you MUST also update
# the inline DATABASE_SERVICE_URL_DOCKER in package.json (dev:infra:test, docker:test:stack*)
# which uses postgres:5432 (Docker-internal) instead of localhost:55432 (host-mapped).

# ── Docker stack provisioning (docker:stack:setup only) ───────────────────────
# These feed provision.sh which creates app_user + app_service roles.
# Not used by the Next.js app directly — only consumed by db-provision container.
POSTGRES_ROOT_USER=postgres
POSTGRES_ROOT_PASSWORD=postgres
POSTGRES_DB=cogni_template_stack_test
APP_DB_NAME=cogni_template_stack_test
APP_DB_USER=app_user
APP_DB_PASSWORD=password
APP_DB_SERVICE_USER=app_service
APP_DB_SERVICE_PASSWORD=service_password

# LiteLLM Integration (for stack tests with real LiteLLM)
# Default models are computed from LiteLLM catalog metadata (metadata.cogni.default_preferred/default_free)
LITELLM_BASE_URL=http://localhost:4000
LITELLM_MASTER_KEY=test-key
OPENROUTER_API_KEY=test-key
# Test config routes all models to mock-openai-api (no real provider keys needed)
LITELLM_CONFIG=litellm.test.config.yaml

# Auth.js (NextAuth) - Required for authentication
AUTH_SECRET=test-auth-secret-at-least-32-chars-long

# Metrics endpoint token (min 32 chars required)
METRICS_TOKEN=test-metrics-token-for-stack-tests

# Scheduler API token (min 32 chars required)
SCHEDULER_API_TOKEN=test-scheduler-api-token-for-stack-min32

# Scheduler worker internal API base URL
# For test:stack:dev (app on host): http://host.docker.internal:3000
# For test:stack:docker (app in Docker): http://app:3000 (default, no override needed)
SCHEDULER_APP_BASE_URL=http://host.docker.internal:3000

NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=walletconnect-project-id

# EVM RPC - Required by compose, but FakeEvmOnchainClient used in test mode (APP_ENV=test)
EVM_RPC_URL=https://rpc.sepolia.org

# Brain repo access (required — no default, no silent cwd fallback)
# "." = local checkout for host-mode tests. See docs/COGNI_BRAIN_SPEC.md "Repo Access Modes".
COGNI_REPO_PATH=.

# git-sync (required for all docker workflows: dev:infra, docker:test:stack)
# The git-sync container clones the repo into a shared volume; the app reads /repo/current.
# Fine-grained PAT: Contents:Read scope, scoped to this repo (public repos work without token)
COGNI_REPO_URL=https://github.com/Cogni-DAO/node-template.git
COGNI_REPO_REF=HEAD
GIT_READ_USERNAME=your-github-username
GIT_READ_TOKEN=your-fine-grained-pat-here

# Temporal Schedule Orchestration (required)
# Stack tests use real Temporal via port forwarding (host-mode vitest + Next.js)
TEMPORAL_ADDRESS=localhost:7233
TEMPORAL_NAMESPACE=cogni-test
TEMPORAL_TASK_QUEUE=scheduler-tasks
